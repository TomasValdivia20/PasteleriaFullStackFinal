# ===================================================================
# CONFIGURACION DE PRODUCCION - RAILWAY + SUPABASE FREE TIER
# ===================================================================
#  OPTIMIZADO PARA: Supabase Free Tier (20 conexiones max)
# Este perfil se activa con SPRING_PROFILES_ACTIVE=production en Railway

# ===================================================================
# HIKARI CONNECTION POOL - ULTRA OPTIMIZADO PARA SUPABASE FREE
# ===================================================================
#  IMPORTANTE: Usa variable de entorno HIKARI_MAX_POOL_SIZE
# Default: 2 conexiones (balance entre performance y l铆mite Supabase)
# Supabase Free Tier: 20 conexiones TOTALES para todas las instancias
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:2}

#  CAMBIO: 0 conexiones idle m铆nimas (reducido de 1)
# Raz贸n: No mantener conexi贸n ociosa cuando no hay tr谩fico
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:0}

#  CAMBIO: Timeout de conexi贸n agresivo (5 segundos)
# Raz贸n: Falla r谩pido si Supabase est谩 saturado
spring.datasource.hikari.connection-timeout=5000

#  CAMBIO CRTICO: Idle timeout 30 segundos (reducido de 10 minutos)
# Raz贸n: Cierra conexiones inactivas r谩pidamente
# Evita acumulaci贸n de conexiones zombies
spring.datasource.hikari.idle-timeout=30000

#  CAMBIO CRTICO: Vida m谩xima 60 segundos (reducido de 20 minutos)
# Raz贸n: Recicla conexi贸n cada minuto
# Previene conexiones zombies de larga duraci贸n
spring.datasource.hikari.max-lifetime=60000

#  Leak detection: 10 segundos (reducido de 15)
# Raz贸n: Detectar leaks de conexi贸n m谩s r谩pido
spring.datasource.hikari.leak-detection-threshold=10000

# ===================================================================
# FLYWAY - DESHABILITADO EN PRODUCCION
# ===================================================================
#  CRTICO: Flyway deshabilitado
# Raz贸n: Migraciones YA aplicadas (V7 exitoso)
# Flyway consume 1 conexi贸n al inicio que no se libera en crash loops
spring.flyway.enabled=false

# ===================================================================
# JPA - SIN LOGGING EN PRODUCCION
# ===================================================================
spring.jpa.show-sql=false
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

#  CRITICAL FIX: Open Session in View para lazy loading durante JSON serialization
# Railway tiene bug de cache - fetch=EAGER NO se aplica en deployments
# Workaround: Mantener sesi贸n Hibernate abierta durante renderizado de vista
# Permite lazy loading de variantes/imagenes durante Jackson serialization
spring.jpa.open-in-view=true

# ===================================================================
# LOGGING - OPTIMIZADO PARA RAILWAY
# ===================================================================
logging.level.root=INFO
logging.level.com.milsabores.backend=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=DEBUG
#  Debug HikariCP para monitorear conexiones
logging.level.org.springframework.jdbc=INFO
logging.level.org.flywaydb=ERROR
# Silenciar Flyway (ya deshabilitado)

# ===================================================================
# ERROR HANDLING
# ===================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
server.error.include-exception=false

# ===================================================================
# JWT SECURITY
# ===================================================================
# Configurado via variables de entorno en Railway:
# - JWT_SECRET
# - JWT_EXPIRATION
