# ===================================================================
# CONFIGURACION DE PRODUCCION - RAILWAY + SUPABASE FREE TIER
# ===================================================================
#  OPTIMIZADO PARA: Supabase Free Tier (20 conexiones max)
# Este perfil se activa con SPRING_PROFILES_ACTIVE=production en Railway

# ===================================================================
# HIKARI CONNECTION POOL - OPTIMIZADO PARA RAILWAY + SUPABASE
# ===================================================================
# NOTA: Railway env vars con SPRING_DATASOURCE_HIKARI_* NO se aplican autom谩ticamente
# Soluci贸n: Usar variables custom y mapearlas aqu铆 con ${VAR:default}

# Maximum Pool Size (lee de Railway env var o default 10)
spring.datasource.hikari.maximum-pool-size=${SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE:10}

# Minimum Idle (lee de Railway env var o default 5)
spring.datasource.hikari.minimum-idle=${SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE:5}

# Connection Timeout (lee de Railway env var o default 30s)
spring.datasource.hikari.connection-timeout=${SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT:30000}

# Idle Timeout (lee de Railway env var o default 10min)
spring.datasource.hikari.idle-timeout=${SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT:600000}

# Max Lifetime (lee de Railway env var o default 30min)
spring.datasource.hikari.max-lifetime=${SPRING_DATASOURCE_HIKARI_MAX_LIFETIME:1800000}

# Leak Detection Threshold (lee de Railway env var o default 60s)
spring.datasource.hikari.leak-detection-threshold=${SPRING_DATASOURCE_HIKARI_LEAK_DETECTION_THRESHOLD:60000}

# Pool Name (para logs)
spring.datasource.hikari.pool-name=HikariPool-Railway

# ===================================================================
# FLYWAY - DESHABILITADO EN PRODUCCION
# ===================================================================
#  CRTICO: Flyway deshabilitado
# Raz贸n: Migraciones YA aplicadas (V7 exitoso)
# Flyway consume 1 conexi贸n al inicio que no se libera en crash loops
spring.flyway.enabled=false

# ===================================================================
# JPA - SIN LOGGING EN PRODUCCION
# ===================================================================
spring.jpa.show-sql=false
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

#  CRITICAL FIX: Open Session in View para lazy loading durante JSON serialization
# Railway tiene bug de cache - fetch=EAGER NO se aplica en deployments
# Workaround: Mantener sesi贸n Hibernate abierta durante renderizado de vista
# Permite lazy loading de variantes/imagenes durante Jackson serialization
spring.jpa.open-in-view=true

# ===================================================================
# LOGGING - OPTIMIZADO PARA RAILWAY
# ===================================================================
logging.level.root=INFO
logging.level.com.milsabores.backend=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=DEBUG
#  Debug HikariCP para monitorear conexiones
logging.level.org.springframework.jdbc=INFO
logging.level.org.flywaydb=ERROR
# Silenciar Flyway (ya deshabilitado)

# ===================================================================
# ERROR HANDLING
# ===================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
server.error.include-exception=false

# ===================================================================
# ACTUATOR - HEALTH CHECKS Y MTRICAS
# ===================================================================
# Habilitar endpoints de actuator
management.endpoints.web.exposure.include=health,info,metrics,loggers
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.health.defaults.enabled=true

# Custom health indicators
management.health.db.enabled=true
management.health.diskSpace.enabled=true

# ===================================================================
# JWT SECURITY
# ===================================================================
# Configurado via variables de entorno en Railway:
# - JWT_SECRET
# - JWT_EXPIRATION
